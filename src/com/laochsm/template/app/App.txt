package $packName$.app

import android.app.Activity
import android.app.Application
import android.content.pm.ApplicationInfo
import android.support.v4.app.Fragment
import dagger.android.DispatchingAndroidInjector
import dagger.android.HasActivityInjector
import dagger.android.HasFragmentInjector
import dagger.android.support.HasSupportFragmentInjector
import javax.inject.Inject

class $Name$ : Application(), HasActivityInjector, HasFragmentInjector, HasSupportFragmentInjector {

    @Inject lateinit var fragmentInjector: DispatchingAndroidInjector<android.app.Fragment>
    @Inject lateinit var activityInjector: DispatchingAndroidInjector<Activity>
    @Inject lateinit var supFragmentInjector: DispatchingAndroidInjector<Fragment>
    @Volatile private var needToInject = true

    override fun activityInjector() = activityInjector
    override fun fragmentInjector() = fragmentInjector
    override fun supportFragmentInjector() = supFragmentInjector

    @Inject
    fun setInjected() {
        needToInject = false
    }

    override fun onCreate() {
        super.onCreate()
        injectIfNecessary()
    }

    private fun isDebug() = applicationInfo.flags and ApplicationInfo.FLAG_DEBUGGABLE != 0

    private fun injectIfNecessary() {
        if (needToInject) {
            synchronized(this, {
                if (needToInject) {
                    DaggerAppComponent.builder().create(this).inject(this)
                }
            })
        }
    }
}
